#!/usr/bin/env bash
set -euo pipefail

# Vulnerability scanner for Clojure projects
# Generates pom.xml from deps.edn, runs Trivy, then cleans up

cd "$(git rev-parse --show-toplevel)"

echo "Generating pom.xml from deps.edn..."
clojure -Spom

echo ""
echo "Running Trivy vulnerability scan..."
trivy fs --scanners vuln .

rm -f pom.xml